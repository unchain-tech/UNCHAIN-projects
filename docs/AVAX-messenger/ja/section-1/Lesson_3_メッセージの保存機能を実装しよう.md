### ğŸ”¥ ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†

å‰å›ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯, `Messenger` ã¨ã„ã†ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

ä»Šå›ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ ¼ç´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç”¨æ„
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡
- ãƒ†ã‚¹ãƒˆ

ğŸ’ ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å†…éƒ¨ã®å‡¦ç†ã‚’ã“ã“ã§æ•´ç†ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å‡ºã¦ãã‚‹ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã¨ã¯, ãƒ†ã‚­ã‚¹ãƒˆã¨ãã“ã«æ·»ä»˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç·ç§°ã—ã¦æŒ‡ã™ã“ã¨ã¨ã—ã¾ã™ã€‚  
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆ**, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ·»ä»˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³**ã¨å‘¼ã¶ã“ã¨ã¨ã—ã¾ã™ã€‚

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚„ã‚Šå–ã‚Šã¯, é€ä¿¡è€…ã‹ã‚‰å—ä¿¡è€…ã¸ç›´æ¥ã§ã¯ãªã, é–“ã«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä»‹ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

- é€ä¿¡è€…ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã‚’è¡Œã†ã¨, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆã‚„é–¢é€£æƒ…å ±ãŒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå†…ã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚
- ã¾ãŸ, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸é€ä¿¡ã•ã‚Œã¾ã™ã€‚
- é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå†…ã§**ä¿ç•™**ã¨ã„ã†çŠ¶æ…‹ã‚’å–ã‚Šã¾ã™ã€‚
- ãã®å¾Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡è€…ãŒè‡ªåˆ†å®›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèªã‚’è¡Œã„, ä¿ç•™ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾ã—ã¦ä»¥ä¸‹ã®äºŒã¤ã®å‹•ä½œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
  - æ‰¿è«¾ -> ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰å—ä¿¡è€…ã¸ãƒˆãƒ¼ã‚¯ãƒ³ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚
  - æ‹’å¦ -> ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã¯è¿”å´ã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰é€ä¿¡è€…ã¸ãƒˆãƒ¼ã‚¯ãƒ³ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

### ğŸª™ ãƒˆãƒ¼ã‚¯ãƒ³

ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«ã¯å¤šãã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ã—ã¾ã™ãŒ,  
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å‡ºã¦ãã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã¯`AVAX`ã‹`ETH`ã‚’ã•ã—ã¾ã™ã€‚

`AVAX`ã¯ `Avalanche` ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒˆãƒ¼ã‚¯ãƒ³ã§, `ETH`ã¯ `Ethereum` ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒˆãƒ¼ã‚¯ãƒ³ã§ã™ã€‚  
ã©ã¡ã‚‰ã‚‚, ãã‚Œãã‚Œã®ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®éš›ã«æ‰‹æ•°æ–™ã¨ã—ã¦å¿…è¦ã§ã™ã€‚

**ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«æ–°ã—ãæƒ…å ±ã‚’æ›¸ãè¾¼ã‚€ã“ã¨**ã‚’,**ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**ã¨å‘¼ã³ã¾ã™ã€‚

ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã¯, AWS ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã‚‹ã‚µãƒ¼ãƒã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚  
ã—ã‹ã—, èª°ã‚‚ãã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰€æœ‰ã—ã¦ã„ã¾ã›ã‚“ã€‚  
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ä½œæ¥­ã‚’ã™ã‚‹äººã€…ãŒä¸–ç•Œä¸­ã«å­˜åœ¨ã—ã¾ã™ã€‚  
ã“ã®ä½œæ¥­ã«å¯¾ã—ã¦, ç§ãŸã¡ã¯ä»£é‡‘ã‚’æ”¯æ‰•ã„ã¾ã™ã€‚  
ãã®ä»£é‡‘ãŒ, **ã‚¬ã‚¹ä»£**ã§ã™ã€‚ `Avalanche` ã® `C-Chain` ä¸Šã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€éš›, ç§ãŸã¡ã¯ä»£é‡‘ã¨ã—ã¦ `AVAX` ã‚’æ”¯æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã„ã¦,  
`C-Chain`ã® EVM äº’æ›ã¨ã„ã†ç‰¹æ€§ã‹ã‚‰,  
ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®é–‹ç™ºã¯ `Ethereum` ä¸Šã§å‹•ãã‚‚ã®ã‚’ä½œã‚Š, ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¯ Avalanche ã®`C-Chain`ã§ã™ã€‚

ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®é–‹ç™ºã¨ã—ã¦ã¯ `Ethereum` ä¸Šã§å‹•ãã‚‚ã®ã¨ã—ã¦ `ETH`(ã¾ãŸã¯`wei`) ã®å˜ä½ã‚’åŸºæº–ã«å®Ÿè£…ã—ãŸæ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

ã—ã‹ã—, å®Ÿéš›ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§æ”¯æ‰•ã‚ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ `AVAX` ãªã®ã§, ã‚¢ãƒ—ãƒªå…¨ä½“ã®è©±ã¨ã—ã¦`AVAX`ã¨ã„ã†è¨€è‘‰ã‚‚ã—ã°ã—å‡ºã¦ãã¾ã™ã€‚

ä»¥ä¸Šã®ã“ã¨ã‚’è¦šãˆã¦ãŠã„ã¦ä¸‹ã•ã„ ğŸ™Œ

å®Ÿè£…æ®µéšã§ `ETH` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚‚ã®ãŒ, ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ™‚ã«ã©ã®ã‚ˆã†ã« `AVAX` ã®å˜ä½ã«å¤‰åŒ–ã•ã‚Œã‚‹ã®ã‹ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç« ã§ãŠè©±ã—ã—ã¾ã™ã€‚

### ğŸ  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ ¼ç´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ç”¨æ„ã—ã‚ˆã†

`Messenger.sol`å†…ã‚’ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§æ›¸ãæ›ãˆã¦ä¸‹ã•ã„ã€‚

```solidity
// Messenger.sol
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.9;

import "hardhat/console.sol";

contract Messenger {
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±ã‚’å®šç¾©ã—ã¾ã™ã€‚
    struct Message {
        address payable sender;
        address payable receiver;
        uint256 depositInWei;
        uint256 timestamp;
        string text;
        bool isPending;
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—å–äººã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’keyã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã™ã€‚
    mapping(address => Message[]) private messagesAtAddress;

    constructor() payable {
        console.log("Here is my first smart contract!");
    }
}
```

è¿½åŠ ã—ãŸå†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

```solidity
    struct Message {
        address payable sender;
        address payable receiver;
        uint256 depositInWei;
        uint256 timestamp;
        string text;
        bool isPending;
    }
```

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±ã‚’[æ§‹é€ ä½“](https://ja.wikipedia.org/wiki/%E6%A7%8B%E9%80%A0%E4%BD%93)ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  
æ§‹é€ ä½“ã®ä¸­ã«ã¯`å‹ å¤‰æ•°å;`ã¨ã„ã†å½¢ã§è¦ç´ ãŒä¸¦ã‚“ã§ã„ã¾ã™ã€‚ã¾ãšã¯å„å¤‰æ•°ãŒä½•ã‚’è¡¨ã™ã®ã‹æ•´ç†ã—ã¾ã—ã‚‡ã†ã€‚

- sender  
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡è€…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
- receiver  
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—å–äººã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
- depositInWei  
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã®é‡ã‚’è¡¨ã—ã¾ã™ã€‚  
  å˜ä½ã‚’ `wei` ã§è¨˜éŒ²ã—ã¾ã™ã€‚
  > `wei` ã¯, ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ã®æœ€å°é¡é¢ã§ã™ã€‚  
  > `1ETH ï¼ 1,000,000,000,000,000,000 wei (10^18)` ã§ã™ã€‚
- timestamp  
  é€ä¿¡è€…ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ãŸã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¡¨ã—ã¾ã™ã€‚
- text  
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ã—ã¾ã™ã€‚
- isPending  
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¿ç•™ä¸­ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’è¡¨ã—ã¾ã™ã€‚  
  `isPending = true`ã§ã‚ã‚Œã°ä¿ç•™ä¸­ã§ã™ã€‚

æ¬¡ã«å‹ã«ã¤ã„ã¦æ•´ç†ã—ã¾ã™ã€‚

- `uint256`: éå¸¸ã«å¤§ããªæ•°ã‚’æ‰±ã†ã“ã¨ãŒã§ãã‚‹**ç¬¦å·ãªã—æ•´æ•°**ã‚’æ ¼ç´ã§ãã¾ã™ã€‚
- `string`: æ–‡å­—åˆ—ãƒ‡ãƒ¼ã‚¿ã«ä½¿ç”¨ã§ãã¾ã™ã€‚
- `bool`: `true`ã‹`false`ã®ã©ã¡ã‚‰ã‹ã®å€¤ã‚’ã¨ã‚Šã¾ã™ã€‚
- `address`: ethereum ã®ã‚¢ãƒ‰ãƒ¬ã‚¹(20 ãƒã‚¤ãƒˆ)ã‚’è¡¨ã™å€¤ã«ä½¿ç”¨ã§ãã¾ã™ã€‚
- `address payable`: `address`ã¨åŒã˜ã§ã™ãŒ, åŠ ãˆã¦ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚„ã‚Šå–ã‚Šã‚’å¯èƒ½ã«ã™ã‚‹å‹ã§ã™ã€‚  
  å…·ä½“çš„ã«ã¯`transfer`ã¨`send`ã¨ã„ã†ãƒ¡ãƒ³ãƒãƒ¼ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™(å¾Œã»ã©å‡ºã¦ãã¾ã™ ğŸ˜)ã€‚

```solidity
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—å–äººã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’keyã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã™ã€‚
    mapping(address => Message[]) private messagesAtAddress;
```

ã“ã“ã§ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±ã‚’ `mapping` ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’åˆ©ç”¨ã—ã¦æ ¼ç´ã§ãã‚‹ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

> ğŸ““ `mapping`  
> Solidity ã® `mapping` ã¯, ã»ã‹ã®è¨€èªã«ãŠã‘ã‚‹ãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã‚„è¾æ›¸ã®ã‚ˆã†ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚  
> ã“ã‚Œã‚‰ã¯, ä¸‹è¨˜ã®ã‚ˆã†ã« `_Key` ã¨ `_Value` ã®ãƒšã‚¢ã®å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
>
> ```javascript
> mappingï¼ˆ_Key => _Valueï¼‰public mappingName
> ```

ã¾ãŸ, `Message[]`ã¯ `Message` ã®[é…åˆ—](https://ja.wikipedia.org/wiki/%E9%85%8D%E5%88%97)ã‚’è¡¨ã—ã¾ã™ã€‚

ä»Šå›ã¯, ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ= `_Key` = `address`ï¼‰ã‚’ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é›†åˆï¼ˆ= `_Value` = `Message[]`ï¼‰ã«é–¢é€£ä»˜ã‘ã‚‹ãŸã‚ã« `mapping` ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

```solidity
    constructor() payable {
        console.log("Here is my first smart contract!");
    }
```

`constructor`ã«`payable`ã¨ã„ã†ä¿®é£¾å­ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚  
`payable`ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚„ã‚Šå–ã‚ŠãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹**é–¢æ•°ä¿®é£¾å­**ã§ã™ã€‚  
é–¢æ•°ä¿®é£¾å­ã«ã¤ã„ã¦ã¯å¾Œã»ã©æ•´ç†ã—ã¾ã™ã€‚

ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆè‡ªä½“ã«è³‡é‡‘ã¨ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒãŸã›ã¦ãŠãå ´åˆ, ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚‚ä½µã›ã¦é€ä¿¡ã—ã¾ã™ã€‚  
ãã®ãŸã‚ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«å®Ÿè¡Œã™ã‚‹`constructor`ã«`payable`ã‚’ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

> âš ï¸ æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæˆã™ã‚‹ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯, ãƒ¦ãƒ¼ã‚¶é–“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚„ã‚Šå–ã‚Šã‚’ä»²ä»‹ã™ã‚‹ã ã‘ãªã®ã§
> ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆè‡ªä½“ãŒè³‡é‡‘ã‚’æŒã£ã¦ãŠãå¿…è¦ãŒãªããªã‚Šã¾ã—ãŸã€‚  
> ãã®ãŸã‚`constructor`ã«ã¤ã‘ã‚‹`payable`ã¨, ã“ã®å¾Œãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«è¡Œã†ãƒˆãƒ¼ã‚¯ãƒ³ã®é€ä¿¡ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ãŒ,
> æœ¬æ‰‹é †ã§ã¯ã“ã®ã¾ã¾é€²ã‚ã¾ã™ã€‚ ğŸ™Œ

ç¶šã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«é–¢æ•°ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```diff
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.9;

import "hardhat/console.sol";

contract Messenger {
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±ã‚’å®šç¾©ã—ã¾ã™ã€‚
    struct Message {
        address payable sender;
        address payable receiver;
        uint256 depositInWei;
        uint256 timestamp;
        string text;
        bool isPending;
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—å–äººã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’keyã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã™ã€‚
    mapping(address => Message[]) private messagesAtAddress;

    constructor() payable {
        console.log("Here is my first smart contract!");
    }

+    // ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Š, çŠ¶æ…‹å¤‰æ•°ã«æ ¼ç´ã—ã¾ã™ã€‚
+    function post(string memory _text, address payable _receiver)
+        public
+        payable
+    {
+        console.log(
+            "%s posts text:[%s] token:[%d]",
+            msg.sender,
+            _text,
+            msg.value
+        );
+
+        messagesAtAddress[_receiver].push(
+            Message(
+                payable(msg.sender),
+                _receiver,
+                msg.value,
+                block.timestamp,
+                _text,
+                true
+            )
+        );
+    }
+
+    // ãƒ¦ãƒ¼ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¨ã¦å–å¾—ã—ã¾ã™ã€‚
+    function getOwnMessages() public view returns (Message[] memory) {
+        return messagesAtAddress[msg.sender];
+    }
}

```

è¿½åŠ ã—ãŸé–¢æ•°ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```solidity
function post(string memory _text, address payable _receiver)
    public
    payable
{
    console.log(
        "%s posts text:[%s] token:[%d]",
        msg.sender,
        _text,
        msg.value
    );

    messagesAtAddress[_receiver].push(
        Message(
            payable(msg.sender),
            _receiver,
            msg.value,
            block.timestamp,
            _text,
            true
        )
    );
}
```

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã§ã™ã€‚  
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå†…ã«è“„ç©ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãªã®ã§, å®Ÿéš›ã«ã¯é€ä¿¡è€…ã‹ã‚‰å—ä¿¡è€…ã¸ã®é€ä¿¡ã¨ã„ã†ã‚ˆã‚Š, é€ä¿¡è€…ã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸ã®æŠ•ç¨¿ã¨ã„ã†æ„å‘³åˆã„ãŒå¼·ã„ã§ã™ã€‚  
ãã®ãŸã‚ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå†…ã§ã¯`post`ã¨ã„ã†é–¢æ•°åã«ã—ã¦ã„ã¾ã™ã€‚  
`post`é–¢æ•°ã¯å¼•æ•°ã«ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨å—ä¿¡è€…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚  
ã•ã‚‰ã«é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã«ã¯ãƒˆãƒ¼ã‚¯ãƒ³(ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã«å½“ãŸã‚Šã¾ã™)ãŒä½µã›ã¦é€ã‚‰ã‚Œã‚‹ã®ã§, ä¿®é£¾å­ã¨ã—ã¦`payable`ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚  
é–¢æ•°å†…ã§ã¯ãƒ­ã‚°ã®å‡ºåŠ›ã¨, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±ã‚’æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚

```solidity
messagesAtAddress[_receiver].push(
    Message(
        payable(msg.sender), // é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹å€¤ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡è€…ã¨ã—ã¦è¨˜éŒ²ã—ã¾ã™ã€‚
        _receiver,
        msg.value, // é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã«é€ä¿¡ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã®å€¤ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦è¨˜éŒ²ã—ã¾ã™ã€‚
        block.timestamp, // æŠ•ç¨¿æ™‚ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
        _text,
        true // å…¨ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æŠ•ç¨¿ç›´å¾Œã¯ä¿ç•™çŠ¶æ…‹ã¨ãªã‚‹ã®ã§, isPendingã‚’trueã¨ã—ã¾ã™ã€‚
    )
);
```

ã“ã“ã§ã¯`messagesAtAddress[_receiver]`ã«ã‚ˆã‚Š, å—ä¿¡è€…ã‚¢ãƒ‰ãƒ¬ã‚¹(`_receiver`)ã«ç´ã¤ã„ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—(`Message[]`)ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚  
`push`ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šé…åˆ—ã«æ–°ãŸãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`msg`ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªå¤‰æ•°ã§,  
`msg.value`ã«ã‚ˆã£ã¦é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã«é€ä¿¡ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã®å€¤ã‚’  
`msg.sender`ã«ã‚ˆã£ã¦é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹å€¤ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

é–¢æ•°ã‚’å‘¼ã³å‡ºã™éš›ã«ã©ã®ã‚ˆã†ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ä¿¡ã™ã‚‹ã®ã‹ã¯ãƒ†ã‚¹ãƒˆã§è¡Œã„ã¾ã™ã€‚

```solidity
    // ãƒ¦ãƒ¼ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¨ã¦å–å¾—ã—ã¾ã™ã€‚
    function getOwnMessages() public view returns (Message[] memory) {
        return messagesAtAddress[msg.sender];
    }
```

`getOwnMessages`é–¢æ•°ã¯  
é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸãƒ¦ãƒ¼ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’`messagesAtAddress[msg.sender]`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

### ğŸ Solidity ã®é–¢æ•°ä¿®é£¾å­ã«ã¤ã„ã¦

ã“ã“ã§ã¯ `Solidity` ã®ç”¨æ„ã™ã‚‹é–¢æ•°ä¿®é£¾å­ã«ã¤ã„ã¦ç°¡å˜ã«æ•´ç†ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ğŸªŸ é–¢æ•°ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«é–¢é€£ã™ã‚‹ä¿®é£¾å­

- **`public`**: `public` ã§å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã‚„å¤‰æ•°ã¯, ãã‚Œã‚‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ, ãã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒç¶™æ‰¿ã•ã‚ŒãŸåˆ¥ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ, ãã‚Œã‚‰ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å¤–éƒ¨ã¨, **åŸºæœ¬çš„ã«ã©ã“ã‹ã‚‰ã§ã‚‚**å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚Solidity ã§ã¯, ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ãŒã¤ã„ã¦ãªã„**é–¢æ•°**ã‚’, è‡ªå‹•çš„ã« `public` ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚

- **`private`**: `private` ã§å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã‚„å¤‰æ•°ã¯, **ãã‚Œã‚‰ãŒå®šç¾©ã•ã‚ŒãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§ã®ã¿**å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

- **`internal`**: `internal` ã§å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã‚„å¤‰æ•°ã¯, **ãã‚Œã‚‰ãŒå®šç¾©ã•ã‚ŒãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ**ã¨, **ãã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒç¶™æ‰¿ã•ã‚ŒãŸåˆ¥ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ**ã®**ä¸¡æ–¹**ã‹ã‚‰å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚Solidity ã§ã¯, ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ãŒã¤ã„ã¦ãªã„**å¤‰æ•°**ã‚’, è‡ªå‹•çš„ã« `internal` ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚

- **`external`**: `external`ã§å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã‚„å¤‰æ•°ã¯, **å¤–éƒ¨ã‹ã‚‰ã®ã¿**å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã«, Solidity ã®ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ã¨ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

![](/public/images/AVAX-messenger/section-1/1_3_2.png)

ğŸ“¡ é–¢æ•°ã®çŠ¶æ…‹ã«é–¢é€£ã™ã‚‹ä¿®é£¾å­

Solidity é–‹ç™ºã§ã¯ã“ã‚Œã‚‰ã®ä¿®é£¾å­ã‚’æ„è­˜ã—ã¦ãŠã‹ãªã„ã¨ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã™ã‚‹éš›ã®ã‚³ã‚¹ãƒˆï¼ˆï¼ã‚¬ã‚¹ä»£ï¼‰ãŒè·³ã­ä¸ŠãŒã£ã¦ã—ã¾ã†ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

ã“ã“ã§ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ã®ã¯, **ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«å€¤ã‚’æ›¸ãè¾¼ã‚€ã«ã¯ã‚¬ã‚¹ä»£ã‚’æ‰•ã†å¿…è¦ãŒã‚ã‚‹ã“ã¨, ãã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‹ã‚‰å€¤ã‚’å‚ç…§ã™ã‚‹ã ã‘ãªã‚‰, ã‚¬ã‚¹ä»£ã‚’æ‰•ã†å¿…è¦ãŒãªã„ã“ã¨ã§ã™ã€‚**

- **`view`**: `view` é–¢æ•°ã¯, èª­ã¿å–ã‚Šå°‚ç”¨ã®é–¢æ•°ã§ã‚ã‚Š, å‘¼ã³å‡ºã—ãŸå¾Œã«é–¢æ•°ã®ä¸­ã§å®šç¾©ã•ã‚ŒãŸçŠ¶æ…‹å¤‰æ•°ãŒå¤‰æ›´ã•ã‚Œãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
- **`pure`**: `pure` é–¢æ•°ã¯, é–¢æ•°ã®ä¸­ã§å®šç¾©ã•ã‚ŒãŸçŠ¶æ…‹å¤‰æ•°ã‚’èª­ã¿è¾¼ã‚“ã ã‚Šå¤‰æ›´ã—ãŸã‚Šã›ãš, é–¢æ•°ã«æ¸¡ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„é–¢æ•°ã«å­˜åœ¨ã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®ã¿ã‚’ä½¿ç”¨ã—ã¦å€¤ã‚’è¿”ã—ã¾ã™ã€‚

ä»¥ä¸‹ã«, Solidity ã®é–¢æ•°ä¿®é£¾å­ `pure` ã¨ `view` ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

![](/public/images/AVAX-messenger/section-1/1_3_3.png)

ã“ã“ã§é‡è¦ãªã®ã¯, `pure` ã‚„ `view` é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚Œã°, **ã‚¬ã‚¹ä»£ã‚’å‰Šæ¸›ã§ãã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚

åŒæ™‚ã«, ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã¾ãªã„ã“ã¨ã§, **å‡¦ç†é€Ÿåº¦ã‚‚å‘ä¸Šã—ã¾ã™**ã€‚

ğŸª™ é–¢æ•°ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹ã“ã¨ã«é–¢é€£ã™ã‚‹ä¿®é£¾å­

é–¢æ•°ã«`payable`ã‚’æŒ‡å®šã™ã‚‹ã¨ãã®é–¢æ•°ã®å‘¼ã³å‡ºã—ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
é€†ã«`payable`ãŒç„¡ã„é–¢æ•°ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ã‚ã†ã¨ã™ã‚‹ã¨é–¢æ•°ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‹’å¦ã—ã¾ã™ã€‚

ğŸš ã‚«ã‚¹ã‚¿ãƒ ã§ãã‚‹ä¿®é£¾å­

é–¢æ•°ã®æŒ™å‹•ã«å½±éŸ¿ã™ã‚‹ã‚ˆã†ãªå‡¦ç†ã‚’è‡ªåˆ†ã§ä½œã£ã¦ä¿®é£¾å­ã¨ã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚  
ã“ã¡ã‚‰ã¯ `section3` ã§å®Ÿè£…ã—ã¾ã™ã€‚

### ğŸ§ª ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã‚ˆã†

è¿½åŠ ã—ãŸæ©Ÿèƒ½ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚  
test ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã® `Messenger.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

- å¤‰æ›´ã™ã‚‹ã¨ç’°å¢ƒã«ã‚ˆã£ã¦èµ¤ã®æ³¢ç·šãŒè¡¨ç¤ºã•ã‚Œã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¶ˆãˆã¾ã™ã®ã§ã€ä¸€æ—¦æ°—ã«ã›ãšé€²ã‚ã¦ãã ã•ã„ã€‚

```ts
import hre, { ethers } from "hardhat";
import { Overrides } from "ethers";
import { expect } from "chai";
import { loadFixture } from "@nomicfoundation/hardhat-network-helpers";

describe("Messenger", function () {
  async function deployContract() {
    // åˆã‚ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
    const [owner, otherAccount] = await ethers.getSigners();

    const funds = 100;

    const Messenger = await hre.ethers.getContractFactory("Messenger");
    const messenger = await Messenger.deploy({
      value: funds,
    } as Overrides);

    return { messenger, funds, owner, otherAccount };
  }

  describe("Post", function () {
    it("Should send the correct amount of tokens", async function () {
      const { messenger, owner, otherAccount } = await loadFixture(
        deployContract
      );
      const test_deposit = 10;

      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’postã—ãŸå ´åˆã¯, é€ã‚Šä¸»(owner)ã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ(messenger)ã¸é€é‡‘ã•ã‚Œã¾ã™ã€‚
      await expect(
        messenger.post("text", otherAccount.address, {
          value: test_deposit,
        })
      ).to.changeEtherBalances(
        [owner, messenger],
        [-test_deposit, test_deposit]
      );
    });

    it("Should set the right Message", async function () {
      const { messenger, owner, otherAccount } = await loadFixture(
        deployContract
      );
      const test_deposit = 1;
      const test_text = "text";

      await messenger.post(test_text, otherAccount.address, {
        value: test_deposit,
      });
      const messages = await messenger.connect(otherAccount).getOwnMessages();
      const message = messages[0];
      expect(message.depositInWei).to.equal(test_deposit);
      expect(message.text).to.equal(test_text);
      expect(message.isPending).to.equal(true);
      expect(message.sender).to.equal(owner.address);
      expect(message.receiver).to.equal(otherAccount.address);
    });
  });
});
```

ãƒ•ã‚¡ã‚¤ãƒ«å†’é ­ã«ã¯ä½¿ç”¨ã™ã‚‹é–¢æ•°ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ import ã—ã¦ã„ã¾ã™ã€‚  
ç’°å¢ƒæ§‹ç¯‰æ™‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ `@nomicfoundation/hardhat-network-helpers` ã‚‚ä½¿ç”¨ã—ã¦ã„ã¦,  
`loadFixture`ã¨ã„ã†é–¢æ•°ã‚’ import ã—ã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«è¿½åŠ ã—ãŸå†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```ts
async function deployContract() {
  // åˆã‚ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  const [owner, otherAccount] = await ethers.getSigners();

  const funds = 100;

  const Messenger = await hre.ethers.getContractFactory("Messenger");
  const messenger = await Messenger.deploy({
    value: funds,
  } as Overrides);

  return { messenger, funds, owner, otherAccount };
}
```

ã“ã¡ã‚‰ã¯å„ãƒ†ã‚¹ãƒˆé–¢æ•°ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å½¹ç›®ã‚’æ‹…ã„ã¾ã™ã€‚  
å‡¦ç†å†…å®¹ã¯, hardhat ãŒç”¨æ„ã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦,
ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±ã‚’è¿”å´ã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚  
å‰å›ã®ãƒ†ã‚¹ãƒˆã§ã¯, ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ã¨ãƒ†ã‚¹ãƒˆã‚’åŒã˜é–¢æ•°å†…ã§ç›´æ¥è¡Œã£ã¦ã„ã¾ã—ãŸãŒ, è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã§åŒã˜ã‚ˆã†ãªå‡¦ç†ã‚’ã™ã‚‹ã®ã§é–¢æ•°ã«åˆ‡ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚

é–¢æ•°å†…ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ `ethers.getSigners()` ã¯ Hardhat ãŒæä¾›ã™ã‚‹ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é…åˆ—ã§è¿”ã™é–¢æ•°ã§ã™ã€‚  
å„ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã¯`10000ether`ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ä¸ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚  
è¿”ã‚Šå€¤ã®ã¯ã˜ã‚ã®è¦ç´ ã¯, ãƒ†ã‚¹ãƒˆå†…ã§ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™éš›ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚ã“ã“ã§ã¯`owner`ã¨åã¥ã‘ã¦ã„ã¾ã™ã€‚  
ã¾ãŸãƒ†ã‚¹ãƒˆå†…ã§ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚„ã‚Šå–ã‚Šã‚’ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ãŸã‚ã«è¤‡æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¿…è¦ãªãŸã‚`otherAccount`ã¨ã„ã†åå‰ã§ä»–ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚å–å¾—ã—ã¦ã„ã¾ã™ã€‚

`deploy`ã«æ³¨ç›®ã—ã¾ã™ã€‚

```ts
const messenger = await Messenger.deploy({
  value: funds,
} as Overrides);
```

ç¾çŠ¶ã® `Messenger` ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«å¼•æ•°ã‚’å–ã‚Šã¾ã›ã‚“ãŒ, è¿½åŠ ã®å¼•æ•°ã¨ã—ã¦`Overrides`ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚  
`Overrides`ã«ã¯ã„ãã¤ã‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã™ãŒ(è©³ã—ãã¯[ã“ã¡ã‚‰](https://docs.ethers.io/v5/api/contract/contract/#Contract-functionsCall)), `value`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯é–¢æ•°å‘¼ã³å‡ºã—ã«ä½µã›ã¦é€ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®é‡ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ä¸Šã§, ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå´ã«ã‚‚ã‚ã‚‹ç¨‹åº¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒãŸã›ã¦ãŠããŸã„ã®ã§ã“ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚  
ãƒˆãƒ¼ã‚¯ãƒ³ã¯é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹`owner`ã‹ã‚‰å¼•ã‹ã‚Œã¾ã™ã€‚  
`funds`ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«æ¸¡ã•ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®é‡ã¨ãªã‚Šã¾ã™ã€‚

ç¶šã„ã¦ãƒ†ã‚¹ãƒˆå†…ã®ä¸€ã¤ç›®ã®é–¢æ•°ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```ts
describe("Post", function () {
  it("Should send the correct amount of tokens", async function () {
    const { messenger, owner, otherAccount } = await loadFixture(
      deployContract
    );
    const test_deposit = 10;

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’postã—ãŸå ´åˆã¯, é€ã‚Šä¸»(owner)ã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ(messenger)ã¸é€é‡‘ã•ã‚Œã¾ã™ã€‚
    await expect(
      messenger.post("text", otherAccount.address, {
        value: test_deposit,
      })
    ).to.changeEtherBalances([owner, messenger], [-test_deposit, test_deposit]);
  });

  // ...
});
```

ã“ã“ã§ã¯`post`é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸå¾Œ, ãƒˆãƒ¼ã‚¯ãƒ³ã®é€ä¿¡ãŒæ­£ã—ãã§ãã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚  
åˆã‚ã«`loadFixture`ã‚’é€šã—ã¦`deployContract`ã‚’å‘¼ã³å‡ºã—, ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚  
ãƒ†ã‚¹ãƒˆææ–™ã¨ã—ã¦`10wei`ã‚’é–¢æ•°å‘¼ã³å‡ºã—ã«ä½µã›ã¦é€ä¿¡ã—ã¾ã™ã€‚  
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡è€…ã‚’`otherAccount`ã¨ã—ã¦`post`é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

> ğŸ““ `loadFixture`ã¨ã¯  
> `loadFixture`ã¯å¼•æ•°ã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ã™ã‚‹é–¢æ•°ã‚’æ¸¡ã—ã¾ã™ã€‚  
> ä»Šå›ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã‚’è¡Œã†`deployContract`ã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚  
> `loadFixture`ãŒåˆå›ã«å‘¼ã°ã‚ŒãŸæ™‚ã¯å¼•æ•°ã®é–¢æ•°ã‚’å®Ÿè¡Œã—, ãã®ãƒã‚§ãƒ¼ãƒ³ã®çŠ¶æ…‹ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚  
> `loadFixture`ãŒäºŒå›ç›®ã«ä»¥é™ã«å‘¼ã°ã‚ŒãŸå ´åˆã¯åˆå›ã«è¨˜éŒ²ã—ãŸãƒã‚§ãƒ¼ãƒ³ã®çŠ¶æ…‹ã‚’è¿”å´ã—ã¾ã™ã€‚  
> ã¤ã¾ã‚Šãƒ†ã‚¹ãƒˆã‚’è¡Œã†ä¸­ã§ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ãƒã‚§ãƒ¼ãƒ³ã®çŠ¶æ…‹ã‚’æ›¸ãæ›ãˆã¦ã—ã¾ã„ã¾ã™ãŒ,
> `loadFixture`ã‚’å‘¼ã³å‡ºã™ã ã‘ã§åˆæœŸçŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ä¾¿åˆ©ãªã®ã§ã™ã€‚

`expect`ã‚’ä½¿ç”¨ã—ã¦, `post`é–¢æ•°ã®å®Ÿè¡Œå¾Œã«`changeEtherBalances`ã¨ã„ã†é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰æ•°ã«å¤‰åŒ–ãŒã‚ã£ãŸã®ã‹ç¢ºèªã—ã¦ã„ã¾ã™ã€‚  
ä¸‹è¨˜ã®å¼•æ•°ã®éƒ¨åˆ†ã¯

```
[owner, messenger], [-test_deposit, test_deposit]
```

ãã‚Œãã‚Œ, `owner`(é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆ)ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒ`test_deposit`åˆ†æ¸›ã‚Š, `messenger`(ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ)ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒ`test_deposit`åˆ†å¢—ãˆã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

æœ€å¾Œã«ã‚‚ã†ä¸€ã¤ã®ãƒ†ã‚¹ãƒˆå†…å®¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```ts
describe("Post", function () {
  // ...

  it("Should set the right Message", async function () {
    const { messenger, owner, otherAccount } = await loadFixture(
      deployContract
    );
    const test_deposit = 1;
    const test_text = "text";

    await messenger.post(test_text, otherAccount.address, {
      value: test_deposit,
    });
    const messages = await messenger.connect(otherAccount).getOwnMessages();
    const message = messages[0];
    expect(message.depositInWei).to.equal(test_deposit);
    expect(message.text).to.equal(test_text);
    expect(message.isPending).to.equal(true);
    expect(message.sender).to.equal(owner.address);
    expect(message.receiver).to.equal(otherAccount.address);
  });
});
```

ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®`post`ã‚’å‘¼ã³å‡ºã™ã¨ã“ã‚ã¾ã§ã¯å…ˆã»ã©ã¨åŒã˜æµã‚Œã§ã™ã€‚  
`post`ã®å‘¼ã³å‡ºã—å¾Œã«`getOwnMessages`ã§æŠ•ç¨¿ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±ã‚’å–å¾—ã—ä¸­èº«ã‚’ç¢ºèªã—ã¾ã™ã€‚  
`getOwnMessages`ã‚’å‘¼ã³å‡ºã™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡è€…ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚`messenger.connect(otherAccount)`ã¨ã„ã†å½¢å¼ã§å‘¼ã³å‡ºã™ã“ã¨ã§  
`otherAccount`ãŒé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ã‚’æŒ‡å®šã§ãã¾ã™ã€‚  
å–ã‚Šå‡ºã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ãŒæ­£ã—ã„ã‹ã‚’ç¢ºã‹ã‚ã¾ã™ã€‚

ãã‚Œã§ã¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ï¼  
`messenger-contract`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```
$ npx hardhat test
```

ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºãŒã•ã‚ŒãŸã‚‰ãƒ†ã‚¹ãƒˆæˆåŠŸã§ã™ï¼

![](/public/images/AVAX-messenger/section-1/1_3_1.png)

### ğŸ™‹â€â™‚ï¸ è³ªå•ã™ã‚‹

ã“ã“ã¾ã§ã®ä½œæ¥­ã§ä½•ã‹ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚‹å ´åˆã¯, Discord ã® `#messenger-dapp` ã§è³ªå•ã‚’ã—ã¦ãã ã•ã„ã€‚

ãƒ˜ãƒ«ãƒ—ã‚’ã™ã‚‹ã¨ãã®ãƒ•ãƒ­ãƒ¼ãŒå††æ»‘ã«ãªã‚‹ã®ã§, ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã«ã¯ä¸‹è¨˜ã® 3 ç‚¹ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ âœ¨

```
1. è³ªå•ãŒé–¢é€£ã—ã¦ã„ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç•ªå·ã¨ãƒ¬ãƒƒã‚¹ãƒ³ç•ªå·
2. ä½•ã‚’ã—ã‚ˆã†ã¨ã—ã¦ã„ãŸã‹
3. ã‚¨ãƒ©ãƒ¼æ–‡ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
4. ã‚¨ãƒ©ãƒ¼ç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
```

---

ãƒ†ã‚¹ãƒˆãŒé€šã£ãŸã‚‰, æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã«é€²ã‚“ã§ãã ã•ã„ ğŸ‰
