### âœˆï¸ ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®åŸºç¤ã‚’å®Ÿè£…ã—ã‚ˆã†

ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã€NEARãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿æ›¸ãã™ã‚‹ç°¡å˜ãªã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
å…·ä½“çš„ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æŒã¤ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§ã™ã€‚

- å®¿æ³Šæ–½è¨­ã®ã‚ªãƒ¼ãƒŠãƒ¼ãŒéƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«ä¿å­˜ã™ã‚‹
- ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã™

### ğŸ“ NEAR ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦

NEARãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«ã¯2ç¨®é¡ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

| ç¨®é¡ | ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹æ“ä½œ | ã€€ã‚¬ã‚¹ä»£ | å®Ÿè¡Œã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æŒ‡å®š |
| ---- | -------------------------------------- | -------- | ------------------------ |
| View | èª­ã¿å–ã‚Š                               | ç„¡æ–™     | å¿…è¦ãªã—                 |
| Call | èª­ã¿å–ã‚Šãƒ»æ›¸ãè¾¼ã¿                     | å¿…è¦     | å¿…è¦                     |

`View`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚¬ã‚¹ä»£ã‚’æ”¯æ‰•ã†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå¿…è¦ãªã„ã®ã§ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ã€Œ`å®¿æ³Šæ–½è¨­ã®ã‚ªãƒ¼ãƒŠãƒ¼ãŒéƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«ä¿å­˜ã™ã‚‹`ã€ãƒ¡ã‚½ãƒƒãƒ‰ãŒ`Call`ãƒ¡ã‚½ãƒƒãƒ‰ã€ã€Œ`ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã™`ã€ãƒ¡ã‚½ãƒƒãƒ‰ãŒ`View`ãƒ¡ã‚½ãƒƒãƒ‰ã«ãªã‚Šã¾ã™ã€‚

### âœï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã‚ˆã†

ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å®Ÿè£…ã«å…¥ã‚‹å‰ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ã‚’è¡Œã„ã¾ã™ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ã‚’ä½œæˆã—ãŸéš›ã€ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦`greeter`ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ã“ã“ã§ã¯ã€`greeter`ã¨æŒ‡å®šã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã‚’`near-hotel-booking-dapp`ç”¨ã«ã€å¤‰æ›´ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ã“ã“ã‹ã‚‰ã¯ã€å…ˆé ­ã®`/`ãŒæ„å‘³ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**(`/near-hotel-booking-dapp`)ã§ã‚ã‚‹ã¨ã—ã¾ã™ã€‚


1. `/contract/Cargo.toml`ã‚’ç·¨é›†

```diff
[package]
- name = "hello_near"
+ name = "hotel_booking"
```

ç·¨é›†å¾Œã€ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒå•é¡Œãªãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

```
yarn deploy
```

å•é¡ŒãŒãªã‘ã‚Œã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
Transaction Id 2hqDQBHSQ8cuXYBjjs1kkPHarfDPDcoRXB6XfFfEMFEE
To see the transaction in the transaction explorer, please open this url in your browser
https://explorer.testnet.near.org/transactions/2hqDQBHSQ8cuXYBjjs1kkPHarfDPDcoRXB6XfFfEMFEE
Done deploying to dev-1659763331754-22161131880735
âœ¨  Done in 9.29s.
```

ã“ã‚Œã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ã¯çµ‚äº†ã§ã™ï¼ å®Ÿéš›ã«ã€ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹`greeter`ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸Šæ›¸ãã—ã¦ã€ã¾ãšã¯ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å®£è¨€ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

`/contract/src/lib.rs`

```rust
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::collections::LookupMap;
use near_sdk::json_types::U128;
use near_sdk::serde::{Deserialize, Serialize};
use near_sdk::{env, near_bindgen, AccountId, Promise};

use std::collections::HashMap;
```

å®£è¨€ã—ãŸå†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
æœ€åˆã®ãƒ–ãƒ­ãƒƒã‚¯ã§ã¯ã€[near_sdk](https://docs.rs/near-sdk/latest/near_sdk/)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ä½¿ç”¨ã—ãŸã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚„ãƒã‚¯ãƒ­ãªã©ã‚’å®£è¨€ã—ã¦ã„ã¾ã™ã€‚`near_sdk`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã¯ã€NEARã‚¹ãƒãƒ¼ãƒˆã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã®Rustãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

```rust
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::collections::LookupMap;
use near_sdk::json_types::U128;
use near_sdk::serde::{Deserialize, Serialize};
use near_sdk::{env, near_bindgen, AccountId, Promise};
```

æ¬¡ã®è¡Œã§ã¯ã€Rustã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ä½¿ç”¨ã—ãŸã„ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®£è¨€ã—ã¦ã„ã¾ã™ã€‚[ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³](https://doc.rust-jp.rs/book-ja/ch08-00-common-collections.html)ã¨ã¯ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ã“ã¨ã§ã™ã€‚

```rust
use std::collections::HashMap;
```

ç¶šã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`/contract/src/lib.rs`

```diff
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::collections::LookupMap;
use near_sdk::json_types::U128;
use near_sdk::serde::{Deserialize, Serialize};
use near_sdk::{env, near_bindgen, AccountId, Promise};

use std::collections::HashMap;

+ type RoomId = String;
+ type CheckInDate = String;
+
+ #[derive(Serialize, Deserialize, Debug, BorshSerialize, BorshDeserialize, PartialEq)]
+ #[serde(crate = "near_sdk::serde")]
+ pub enum UsageStatus {
+     Available,                           // ç©ºå®¤
+     Stay { check_in_date: CheckInDate }, // æ»åœ¨ä¸­
+ }
+
+ // ã‚ªãƒ¼ãƒŠãƒ¼ãŒç™»éŒ²ã—ãŸéƒ¨å±‹ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹éš›ã«ä½¿ç”¨
+ #[derive(Serialize, Deserialize, Debug, BorshSerialize, BorshDeserialize)]
+ #[serde(crate = "near_sdk::serde")]
+ pub struct RegisteredRoom {
+     name: String,
+     image: String,
+     beds: u8,
+     description: String,
+     location: String,
+     price: U128,
+     status: UsageStatus,
+ }
+
+ // å®Ÿéš›ã«ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«ä¿å­˜ã•ã‚Œã‚‹éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿
+ #[derive(BorshDeserialize, BorshSerialize)]
+ pub struct Room {
+     name: String,        // éƒ¨å±‹ã®åå‰
+     owner_id: AccountId, // ã‚ªãƒ¼ãƒŠãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
+     image: String,       // éƒ¨å±‹ã®ç”»åƒï¼ˆURLï¼‰
+     beds: u8,            // ãƒ™ãƒƒãƒ‰ã®æ•°
+     description: String, // éƒ¨å±‹ã®èª¬æ˜
+     location: String,    // æ–½è¨­ã®å ´æ‰€
+     price: U128,         // ä¸€æ³Šã®å®¿æ³Šæ–™
+     status: UsageStatus, // åˆ©ç”¨çŠ¶æ³
+     booked_info: HashMap<CheckInDate, AccountId>, // äºˆç´„ãƒ‡ãƒ¼ã‚¿[å®¿æ³Šæ—¥, å®¿æ³Šè€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID]
+ }
```

è¿½åŠ ã—ãŸå†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

æœ€åˆã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ã€æ—¢å­˜ã®å‹(ä»Šå›ã¯`String`)ã«å¯¾ã—ã¦åˆ¥ã®åå‰ã‚’ã¤ã‘ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’å®£è¨€ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ã€[å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹](https://doc.rust-jp.rs/book-ja/ch19-04-advanced-types.html?highlight=type#%E5%9E%8B%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9%E3%81%A7%E5%9E%8B%E5%90%8C%E7%BE%A9%E8%AA%9E%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B)ï¼ˆtype aliasï¼‰ã‚’å®£è¨€ã™ã‚‹ã¨è¨€ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€

- ã€ŒStringå‹ã«`RoomId`Â  ã¨ã„ã†åˆ¥åã‚’ã¤ã‘ã¾ã™ã€

ã¨å®£è¨€ã‚’ã—ã¦ã„ã¾ã™ã€‚

```rust
type RoomId = String;
type CheckInDate = String;
```

ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ãƒãƒƒãƒ—ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€ä½•ã‚’ã‚­ãƒ¼ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ã®ã‚’ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã«å®£è¨€ã—ã¾ã—ãŸã€‚

æ¬¡ã®ãƒ–ãƒ­ãƒƒã‚¯ã§ã¯ã€[åˆ—æŒ™å‹](https://doc.rust-jp.rs/book-ja/ch06-00-enums.html)(`Enum`)ã¨å‘¼ã°ã‚Œã‚‹å‹ã§æ‰±ã„ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ãƒªãƒ³ã‚¯å…ˆã®ç« ã§ã¯ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç”¨ã„ã¦åˆ—æŒ™å‹ã®æ¦‚å¿µã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’èº«è¿‘ãª`ä¿¡å·æ©Ÿ`ã«ç½®ãæ›ãˆã¦ã¿ã‚‹ã¨ã‚ˆã‚Šã‚ã‹ã‚Šã‚„ã™ã„ã‹ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã¯ã€éƒ¨å±‹ã®åˆ©ç”¨çŠ¶æ³ã‚’è¡¨ã™ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```rust
#[derive(Serialize, Deserialize, Debug, BorshSerialize, BorshDeserialize, PartialEq)]
#[serde(crate = "near_sdk::serde")]
pub enum UsageStatus {
    Available,
    Stay { check_in_date: CheckInDate },
}
```

æ¬¡ã®2ã¤ã®ãƒ–ãƒ­ãƒƒã‚¯ã§ã¯ã€éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã„ãŸã„ã‚‚ã®ã‚’æ§‹é€ ä½“ã‚’ä½¿ç”¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
`RegisteredRoom`æ§‹é€ ä½“ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã‹ã‚‰éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã™éš›ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```rust
#[derive(Serialize, Deserialize, Debug, BorshSerialize, BorshDeserialize)]
#[serde(crate = "near_sdk::serde")]
pub struct RegisteredRoom {
    name: String,
    image: String,
    beds: u8,
    description: String,
    location: String,
    price: U128,
    status: UsageStatus,
}
```

`Room`æ§‹é€ ä½“ã¯ã€å®Ÿéš›ã«ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«æ›¸ãè¾¼ã‚€éš›ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```rust
#[derive(BorshDeserialize, BorshSerialize)]
pub struct Room {
    name: String,        // éƒ¨å±‹ã®åå‰
    owner_id: AccountId, // ã‚ªãƒ¼ãƒŠãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
    image: String,       // éƒ¨å±‹ã®ç”»åƒï¼ˆURLï¼‰
    beds: u8,            // ãƒ™ãƒƒãƒ‰ã®æ•°
    description: String, // éƒ¨å±‹ã®èª¬æ˜
    location: String,    // æ–½è¨­ã®å ´æ‰€
    price: U128,         // ä¸€æ³Šã®å®¿æ³Šæ–™
    status: UsageStatus, // åˆ©ç”¨çŠ¶æ³
    booked_info: HashMap<CheckInDate, AccountId>, // äºˆç´„ãƒ‡ãƒ¼ã‚¿[å®¿æ³Šæ—¥, å®¿æ³Šè€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID]
}
```

æœ€å¾Œã«ã€Enumã¨æ§‹é€ ä½“ã®ä¸Šã«æ›¸ã‹ã‚Œã¦ã„ãŸ`#[derive(...)]`ã¨`#[serde(...)]`ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

ã“ã‚Œã¯ã€[ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ](https://doc.rust-jp.rs/rust-by-example-ja/attribute.html)ï¼ˆå±æ€§ï¼‰ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚ä½•ã‚’ã—ã¦ã„ã‚‹ã‹ã¨ã„ã†ã¨ã€

- `#[derive]`å±æ€§ã¯å‹ã«å¯¾ã—ã¦ç‰¹å®šã®ãƒˆãƒ¬ã‚¤ãƒˆã®å®Ÿè£…ã‚’æä¾›ã—ã¾ã™ã€‚
- `#[serde]`å±æ€§ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®å®Ÿè£…ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚

[ãƒˆãƒ¬ã‚¤ãƒˆ](https://doc.rust-jp.rs/book-ja/ch10-02-traits.html)ã¨ã¯ã€å…±é€šã®æŒ¯ã‚‹èˆã„ã‚’å®šç¾©ã™ã‚‹ã‚‚ã®ã§ã™ã€‚`#[derive](...)`ã®`(...)`ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ãŒãƒˆãƒ¬ã‚¤ãƒˆã§ã™ã€‚

`ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º`ã¨ã¯ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ–‡å­—åˆ—ã‚„ãƒã‚¤ãƒˆåˆ—ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã™ã€‚
`ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º`ã¨ã¯ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºæ“ä½œã«ã‚ˆã£ã¦å¤‰æ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¾©å…ƒã™ã‚‹å‡¦ç†ã®ã“ã¨ã§ã™ã€‚
`#[serde(crate = "near_sdk::serde")]`ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ã©ã®ã‚ˆã†ã«å¤‰æ›ã™ã‚‹ã‹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
`near_sdk`ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯[ã“ã¡ã‚‰](https://www.near-sdk.io/contract-interface/serialization-interface)ã€‚

æœ€å¾Œã«ã€ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®è¦ã¨ãªã‚‹æ§‹é€ ä½“ã‚’å®šç¾©ã—ã¾ã™ã€‚

`/contract/src/lib.rs`

```diff
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::collections::LookupMap;
use near_sdk::json_types::U128;
use near_sdk::serde::{Deserialize, Serialize};
use near_sdk::{env, near_bindgen, AccountId};

use std::collections::HashMap;

type RoomId = String;
type CheckInDate = String;

#[derive(Serialize, Deserialize, Debug, BorshSerialize, BorshDeserialize, PartialEq)]
#[serde(crate = "near_sdk::serde")]
pub enum UsageStatus {
    Available,
    Stay { check_in_date: CheckInDate },
}

#[derive(Serialize, Deserialize, Debug, BorshSerialize, BorshDeserialize)]
#[serde(crate = "near_sdk::serde")]
pub struct RegisteredRoom {
    name: String,
    image: String,
    beds: u8,
    description: String,
    location: String,
    price: U128,
    status: UsageStatus,
}

#[derive(BorshDeserialize, BorshSerialize)]
pub struct Room {
    name: String,
    owner_id: AccountId,
    image: String,
    beds: u8,
    description: String,
    location: String,
    price: U128,
    status: UsageStatus,
    booked_info: HashMap<CheckInDate, AccountId>,
}

+ #[near_bindgen]
+ #[derive(BorshSerialize, BorshDeserialize)]
+ pub struct Contract {
+     rooms_per_owner: LookupMap<AccountId, Vec<RoomId>>,
+     rooms_by_id: HashMap<RoomId, Room>,
+ }
```

è¿½åŠ ã—ãŸå†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

`Contract`ã¨åå‰ã‚’ã¤ã‘ãŸæ§‹é€ ä½“ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚æ³¨ç›®ã—ã¦æ¬²ã—ã„ã®ã¯ã€`#[near_bindgen]`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚`near_bindgen`ã¯ã€æ§‹é€ ä½“ã¨é–¢æ•°å®šç¾©ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€NEARãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã¨äº’æ›æ€§ã®ã‚ã‚‹ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

ç¶šã„ã¦ã€æ§‹é€ ä½“ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

```rust
pub struct Contract {
    rooms_per_owner: LookupMap<AccountId, Vec<RoomId>>,
    rooms_by_id: HashMap<RoomId, Room>,
}
```

2ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

- `rooms_per_owner`: éƒ¨å±‹ã®ã‚ªãƒ¼ãƒŠãƒ¼ã®`AccountId`ã¨ãã®éƒ¨å±‹ã‚’ç´ä»˜ã‘ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¾ã™ã€‚
  - `AccountId`ã¨ã¯ã€near_sdkã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å‹ã§ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’æ‰±ã†ãŸã‚ã®æ§˜ã€…ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒˆãƒ¬ã‚¤ãƒˆã‚’æŒã£ã¦ã„ã¾ã™ã€‚
  - `LookupMap`ã¨ã¯ã€near_sdkãŒå®šç¾©ã™ã‚‹ç‰¹æ®Šãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿é‡ãŒå°‘ãªãã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚è‰¯ã„ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚­ãƒ¼ã‹ã‚‰å€¤ã¸ã®ãƒãƒƒãƒ—ã—ã‹æŒã£ã¦ã„ãªã„ã€‚ã‚­ãƒ¼ã®ãƒ™ã‚¯ãƒˆãƒ«ãŒãªã‘ã‚Œã°ã€ã‚­ãƒ¼ã‚’åå¾©ã™ã‚‹æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- `rooms_by_id`: å„éƒ¨å±‹ã®è­˜åˆ¥å­(`RoomId`)ã¨éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤`Room`æ§‹é€ ä½“ã‚’ç´ä»˜ã‘ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¾ã™ã€‚
  - `HashMap`ã¨ã¯ã€Rustã®æ¨™æº–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå®šç¾©ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚æ ¼ç´ã™ã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦å‡¦ç†ã‚’è¡Œã†å ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚

`rooms_per_owner`ã¯ã€`LookupMap`ãŒæŒã¤æ©Ÿèƒ½ã ã‘ã§ååˆ†ãªã®ã§ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«`LookupMap`ã‚’é¸æŠã—ã¦ã„ã¾ã™ã€‚

### ğŸ™‹â€â™‚ï¸ è³ªå•ã™ã‚‹

ã“ã“ã¾ã§ã®ä½œæ¥­ã§ä½•ã‹ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚‹å ´åˆã¯ã€Discordã®`#near`ã§è³ªå•ã‚’ã—ã¦ãã ã•ã„ã€‚

ãƒ˜ãƒ«ãƒ—ã‚’ã™ã‚‹ã¨ãã®ãƒ•ãƒ­ãƒ¼ãŒå††æ»‘ã«ãªã‚‹ã®ã§ã€ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã«ã¯ä¸‹è¨˜ã®4ç‚¹ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ âœ¨

```
1. è³ªå•ãŒé–¢é€£ã—ã¦ã„ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç•ªå·ã¨ãƒ¬ãƒƒã‚¹ãƒ³ç•ªå·
2. ä½•ã‚’ã—ã‚ˆã†ã¨ã—ã¦ã„ãŸã‹
3. ã‚¨ãƒ©ãƒ¼æ–‡ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
4. ã‚¨ãƒ©ãƒ¼ç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
```

---

æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã«é€²ã¿ã€å®Ÿéš›ã«éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»å–å¾—ãŒã§ãã‚‹ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼
